import{r as l,U as b,V as y,o as s,d,f as e,a as Q,l as k,j as f,n as C,h as P,O as I,P as z,L as u,g as h,M,Y as D,W as J}from"./index-d6a89262.js";import{u as W}from"./carrinho-1e4c1c4d.js";const X={__name:"MPesa",props:{modelValue:String},setup(g,{expose:v}){const o=l(g.modelValue);return v({validar:()=>!o.value||o.value.length<9?(alert("Número MPESA inválido."),!1):!0}),(_,i)=>b((s(),d("input",{"onUpdate:modelValue":i[0]||(i[0]=c=>o.value=c),placeholder:"Digite o número MPESA"},null,512)),[[y,o.value]])}},Y=e("label",{for:"depositoBancarioDados",class:"block text-lg"},"Dados para Depósito Bancário",-1),G={__name:"DepositoBancario",setup(g){return l(""),(v,r)=>(s(),d("div",null,[Y,b(e("input",{type:"text",id:"depositoBancarioDados","onUpdate:modelValue":r[0]||(r[0]=o=>v.depositoBancarioDados=o),class:"border p-2 rounded w-full",placeholder:"Digite os dados para o depósito bancário"},null,512),[[y,v.depositoBancarioDados]])]))}},H=e("label",{for:"transferenciaMovelDados",class:"block text-lg"},"Dados da Transferência Móvel",-1),K={__name:"TransferenciaMovel",setup(g){return l(""),(v,r)=>(s(),d("div",null,[H,b(e("input",{type:"text",id:"transferenciaMovelDados","onUpdate:modelValue":r[0]||(r[0]=o=>v.transferenciaMovelDados=o),class:"border p-2 rounded w-full",placeholder:"Digite os dados da transferência móvel"},null,512),[[y,v.transferenciaMovelDados]])]))}},ee={__name:"Cartao",props:{modelValue:Object},setup(g,{expose:v}){const r=g,o=l({numero:r.modelValue.numero,validade:r.modelValue.validade,cvv:r.modelValue.cvv});return v({validar:()=>{const{numero:_,validade:i,cvv:c}=o.value;if(!_||_.length<16)return alert("Número do cartão inválido."),!1;const w=/^(0[1-9]|1[0-2])\/\d{2}$/;return!i||!i.match(w)?(alert("Data de validade inválida."),!1):!c||c.length!==3?(alert("CVV inválido."),!1):!0}}),(_,i)=>(s(),d("div",null,[b(e("input",{"onUpdate:modelValue":i[0]||(i[0]=c=>o.value.numero=c),placeholder:"Número do cartão",type:"text"},null,512),[[y,o.value.numero]]),b(e("input",{"onUpdate:modelValue":i[1]||(i[1]=c=>o.value.validade=c),placeholder:"MM/AA",type:"text"},null,512),[[y,o.value.validade]]),b(e("input",{"onUpdate:modelValue":i[2]||(i[2]=c=>o.value.cvv=c),placeholder:"CVV",type:"text"},null,512),[[y,o.value.cvv]])]))}};const ae={key:0,class:"checkout-container py-10"},te={class:"steps-header flex justify-center mb-8 flex-wrap"},oe=e("span",{class:"step-number"},"1.",-1),se=e("div",{class:"divider hidden md:block"},null,-1),ne=e("span",{class:"step-number"},"2.",-1),re=e("div",{class:"divider hidden md:block"},null,-1),le=e("span",{class:"step-number"},"3.",-1),ie={key:0,class:"step-content mx-2"},de=e("h2",{class:"text-2xl font-bold text-gray-800 mb-6"},"Resumo do Pedido",-1),ce={class:"order-summary border p-4 rounded-lg"},ue={class:"flex-shrink-0"},ve=["src"],pe={class:"flex flex-col ml-4 w-1/2"},me={class:"font-semibold"},_e={key:0,class:"flex items-center"},fe={class:"line-through text-gray-500"},he={class:"text-green-500 mx-2"},ge={key:1},be={class:"flex justify-center items-center space-x-4 w-1/4"},ye=["onClick","disabled"],xe={class:"font-semibold text-lg"},ke=["onClick","disabled"],Ve={class:"flex-shrink-0 ml-4 w-1/4 text-center"},Ce=["onClick"],Me={class:"totals mt-6 flex justify-between flex-col"},De={class:"font-bold"},we={key:1,class:"step-content mx-2"},Se=e("h2",{class:"text-2xl font-bold text-gray-800 mb-6"},"Informações de Pagamento",-1),Pe={class:"payment-methods flex justify-around my-4"},Ne=["onClick"],Re=["src"],je={class:"payment-details"},Ae={key:2,class:"step-content mx-2"},Be=e("h2",{class:"text-2xl font-bold text-gray-800 mb-6"},"Revisão e Confirmação",-1),Te={class:"final-review"},Ue={key:1},qe=e("p",{class:"text-center text-2xl flex justify-center items-center min-h-[250px]"},"Seu carrinho está vazio!",-1),$e=[qe],Oe={__name:"Page",setup(g){const v=Q(),r=W(),o=l("MPESA"),x=l(""),_=l(""),i=l(""),c=l({numero:"",validade:"",cvv:""}),w=l([{value:"MPESA",icon:D+"images/payments/M-pesa-logo1.png"},{value:"Deposito_Bancario",icon:D+"images/payments/banco.png"},{value:"Transferencia_Movel",icon:D+"images/payments/transferencia-de-dinheiro.png"},{value:"Cartao",icon:D+"images/payments/cartao-de-credito.png"}]),N=l(null),R=l(null),j=l(null),A=l(null),B=async()=>{var n,t,a,m;switch(o.value){case"MPESA":return await((n=N.value)==null?void 0:n.validar());case"Deposito_Bancario":return await((t=R.value)==null?void 0:t.validar());case"Transferencia_Movel":return await((a=j.value)==null?void 0:a.validar());case"Cartao":return await((m=A.value)==null?void 0:m.validar());default:return!1}},p=l(1),T=async()=>{p.value===2&&!await B()||p.value<3&&p.value++},U=()=>{p.value>1&&p.value--},V=k(()=>r.itens),Z=k(()=>r.quantidadeTotal),q=k(()=>V.value.reduce((n,t)=>n+t.quantidade*t.preco,0)),O=k(()=>V.value.reduce((n,t)=>{const a=t.precoAntigo?t.precoAntigo:t.preco;if(t.desconto){const m=a*t.desconto/100;return n+t.quantidade*m}return n},0).toFixed(2)),$=k(()=>q.value.toFixed(2)),S=l(!1);localStorage.getItem("sigtransport_accessToken")?S.value=!0:S.value=!1;const E=(n,t)=>{const a=n.quantidade+t;a>=1&&a<=n.lugaresRestantes&&(n.quantidade=a,r.salvarNoLocalStorage())},F=n=>{r.removerDoCarrinho(n)},L=async()=>{if(S.value===!1){alert("Usuário não autenticado!");return}if(!B())return;const n=JSON.parse(localStorage.getItem("carrinho"));if(!n||n.length===0){alert("O carrinho está vazio!");return}const t={id_user:userId,bilhetes:n.map(a=>({bilhete_id:a.id.toString(),quantidade:a.quantidade.toString()})),payment_type:o.value};o.value==="MPESA"&&(t.mpesa_number=x.value),o.value==="Cartao"&&(t.cartao_numero=cartaoNumero.value,t.cartao_validade=cartaoValidade.value,t.cartao_cvv=cartaoCVV.value);try{const a=await J.post("/ordens",t);if(a.status===200){const m=a.data.id;alert("Compra finalizada com sucesso!"),localStorage.removeItem("carrinho"),r.limparCarrinho(),v.push({name:"checkout.confirmation",params:{order_id:m}})}}catch(a){console.error("Erro ao finalizar a compra:",a),alert("Ocorreu um erro ao processar sua compra. Tente novamente mais tarde.")}};return(n,t)=>f(Z)>0?(s(),d("div",ae,[e("div",te,[e("div",{class:C(["step",{active:p.value===1}])},[oe,P(" Resumo do Pedido ")],2),se,e("div",{class:C(["step",{active:p.value===2}])},[ne,P(" Informações de Pagamento ")],2),re,e("div",{class:C(["step",{active:p.value===3}])},[le,P(" Revisão e Confirmação ")],2)]),p.value===1?(s(),d("div",ie,[de,e("div",ce,[(s(!0),d(I,null,z(f(V),a=>(s(),d("div",{key:a.id,class:"order-item flex justify-between items-center mb-4 border-b pb-4"},[e("div",ue,[e("img",{src:a.imagem,alt:"Produto",class:"w-16 h-16 object-cover rounded-md"},null,8,ve)]),e("div",pe,[e("p",me,u(a.from)+" - "+u(a.to),1),a.desconto?(s(),d("p",_e,[e("span",fe,u(a.precoAntigo)+" MZN",1),e("span",he,u(a.preco)+" MZN",1)])):(s(),d("p",ge,u(a.preco)+" MZN ",1))]),e("div",be,[e("button",{onClick:m=>E(a,-1),disabled:a.quantidade<=1,class:"bg-gray-300 text-gray-800 rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-400 transition duration-200"}," - ",8,ye),e("span",xe,u(a.quantidade),1),e("button",{onClick:m=>E(a,1),disabled:a.quantidade>=a.lugaresRestantes,class:"bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-green-600 transition duration-200"}," + ",8,ke)]),e("div",Ve,[e("button",{onClick:m=>F(a.id),class:"bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center hover:bg-red-600 transition duration-200"}," X ",8,Ce)])]))),128)),e("div",Me,[e("p",null,"Subtotal: "+u(f(q))+" MZN",1),e("p",null,"Desconto: -"+u(f(O))+" MZN",1),e("p",De,"Total: "+u(f($))+" MZN",1)])]),e("button",{onClick:T,class:"btn-primary mt-6"},"Continuar para Pagamento")])):h("",!0),p.value===2?(s(),d("div",we,[Se,e("div",Pe,[(s(!0),d(I,null,z(w.value,(a,m)=>(s(),d("div",{key:m,onClick:Ie=>o.value=a.value,class:C({"border-2 border-blue-500":o.value===a.value,"cursor-pointer":!0,"p-4":!0,rounded:!0,flex:!0,"items-center":!0,"justify-center":!0})},[e("img",{src:a.icon,alt:"Método de pagamento",class:"w-20 h-20 object-contain"},null,8,Re)],10,Ne))),128))]),e("div",je,[o.value==="MPESA"?(s(),M(X,{key:0,modelValue:x.value,"onUpdate:modelValue":t[0]||(t[0]=a=>x.value=a),ref_key:"mpesaRef",ref:N},null,8,["modelValue"])):h("",!0),o.value==="Deposito_Bancario"?(s(),M(G,{key:1,modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=a=>_.value=a),ref_key:"depositoRef",ref:R},null,8,["modelValue"])):h("",!0),o.value==="Transferencia_Movel"?(s(),M(K,{key:2,modelValue:i.value,"onUpdate:modelValue":t[2]||(t[2]=a=>i.value=a),ref_key:"transferenciaRef",ref:j},null,8,["modelValue"])):h("",!0),o.value==="Cartao"?(s(),M(ee,{key:3,modelValue:c.value,"onUpdate:modelValue":t[3]||(t[3]=a=>c.value=a),ref_key:"cartaoRef",ref:A},null,8,["modelValue"])):h("",!0)]),e("button",{onClick:U,class:"btn-secondary mt-6"},"Voltar"),e("button",{onClick:T,class:"btn-primary mt-6 mx-2"},"Revisar Pedido")])):h("",!0),p.value===3?(s(),d("div",Ae,[Be,e("div",Te,[e("p",null,"Itens: "+u(f(V).length),1),e("p",null,"Total: "+u(f($))+" MZN",1),e("p",null,"Método de Pagamento: "+u(o.value),1)]),e("button",{onClick:U,class:"btn-secondary mt-6"},"Voltar"),e("button",{onClick:L,class:"btn-primary mt-6 mx-2"},"Finalizar Compra")])):h("",!0)])):(s(),d("div",Ue,$e))}};export{Oe as default};
